#summary libkml google maps data reference

= !GoogleMapsData and !HttpClient =

The !GoogleMapsData class provides a C++ API to the Google Maps Data API.
This document provides an overview of the functionality of this API.

There are two main components: the 
[http://code.google.com/p/libkml/source/browse/trunk/src/kml/convenience/google_maps_data.h GoogleMapsData]
class and a class you supply derived from the
[http://code.google.com/p/libkml/source/browse/trunk/src/kml/convenience/http_client.h HttpClient] class.

For the most part the !GoogleMapsData methods package up HTTP POST
and GET requests, thus this class is part of the convenience methods
of libkml.  There are two kinds of data passed over HTTP: Atom
and media where media is CSV or KML all of which are supported in libkml.

See the
[http://code.google.com/apis/maps/documentation/mapsdata/developers_guide_protocol.html Google Maps Data API HTTP Protocol Guide] for the details of the HTTP protocol.

In addition to the Google Maps Data API there are also classes in libkml with
limited support for
[http://code.google.com/apis/documents/overview.html Google Documents List Data API],
[http://code.google.com/apis/spreadsheets/data/3.0/developers_guide.html Google Spreadsheets Data API], and
[http://code.google.com/apis/picasaweb/overview.html Google PicasaWeb API]
in the
[http://code.google.com/p/libkml/source/browse/trunk/src/kml/convenience/google_doc_list.h GoogleDocList],
[http://code.google.com/p/libkml/source/browse/trunk/src/kml/convenience/google_spreadsheets.h GoogleSpreadsheets], and
[http://code.google.com/p/libkml/source/browse/trunk/src/kml/convenience/google_picasa_web.h GooglePicasaWeb] classes respectively.

== !HttpClient ==

A !GoogleMapsData instance requires a !HttpClient to perform communications.

{{{
class YourHttpClient : public kmlconvenience::HttpClient {
 public:
  virtual bool SendRequest(...) const {
    ...your network I/O code goes here...
  }
};
}}}

An !HttpClient must be logged in to the appropriate service.
Here is an example of an !HttpClient logged in to the Google Maps Data API:

{{{
YourHttpClient* your_http_client = new YourHttpClient("your-app-name");
const string& maps_data = GoogleMapsData::get_service_name();
string user_name = [prompt user]
string password = [prompt user]
your_http_client->Login(maps_data, user_name, password);
}}}

See
[http://code.google.com/p/libkml/source/browse/trunk/examples/hellonet/curlfetch.h CurlHttpFetch]
for an !HttpClient using [http://curl.haxx.se/libcurl/ libcurl].
libcurl is not provided with libkml but it is
available for most any platform.

== !GoogleMapsData ==

The !GoogleMapsData::Create static method creates a !GoogleMapsData object
using the created and logged-in !HttpClient:

{{{
GoogleMapsData* maps_data = GoogleMapsData::Create(your_http_client);
}}}

The !GetMetaFeed() method fetches and parses the Atom feed of the list of
the user's maps:

{{{
kmldom::AtomFeedPtr meta_feed = maps_data->GetMetaFeed();
}}}

The Atom `entry and `feed` elements are supported by libkml:

{{{
for (size_t e = 0; e < meta_feed->get_entry_array_size(); ++e) {
  const kmldom::AtomEntryPtr& entry = meta_feed->get_entry_array_at(e);
  std::cout << "[title] " << entry->get_title() << std::endl;
}
}}}

The are additional methods on !GoogleMapsData to:
  * Create a new map
  * Add KML Features to a map
  * Get KML Features in a map

See [http://code.google.com/p/libkml/source/browse/trunk/src/kml/convenience/google_maps_data.h google_maps_data.h] for details.

== Google Maps Data media support ==

In addition to Atom-based HTTP POST and GET the Google Maps Data API
supports raw media-based HTTP POST as well.

The [http://code.google.com/p/libkml/source/browse/trunk/src/kml/convenience/google_maps_data.h PostCsv] method creates a new map and adds to it a feature
from each line in a CSV file.

{{{
// You'll be reading your CSV from a big file no doubt, but here is
// a very simple CSV.  First line is the "schema", each subsequent line is
// a <Point> <Placemark>.
string csv_data = "name,latitude,longitude,description\n"
                  "hello,-77.066395,-11.968312,"Welcome to Lima,Peru!"\n";

// This does exactly one HTTP POST.  Your code will check for errors.
AtomEntryPtr entry = google_maps_data->PostCsv("Hello Lima", csv_data, NULL);

// Here's how to get the URL for the KML of your new map.
string kml_url;
GoogleMapsData::GetKmlUri(entry, &kml_uri);
}}}

== Examples ==

There are many example command line programs using the !GoogleMapsData and
other Google Data API classes:

Also see the
[http://code.google.com/p/libkml/source/browse/trunk/examples/hellonet/listgmaps.cc listgmaps.cc],
[http://code.google.com/p/libkml/source/browse/trunk/examples/hellonet/getgmapkml.cc getgmapkml.cc],
and
[http://code.google.com/p/libkml/source/browse/trunk/examples/hellonet/uploadgmap.cc uploadgmap.cc]
examples.
